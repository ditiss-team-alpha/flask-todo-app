#!/bin/bash

# Exit immediately if a command exits with a non-zero status
set -e

# Define site directory (you can customize this path)
SITE_DIR="$HOME/my_docker_site"

# 1. Create project directory
echo "Creating project directory..."
mkdir -p "$SITE_DIR"
cd "$SITE_DIR" || exit

# 2. Create index.html
echo "Creating index.html..."
echo "<h1>Hello from Docker on AWS Debian!</h1>" > index.html

# 3. Create Dockerfile
echo "Creating Dockerfile..."
cat << 'EOF' > Dockerfile
# Use an official Nginx image as the base
FROM nginx:alpine

# Copy your static site files into Nginx's web directory
COPY . /usr/share/nginx/html

# Expose port 80
EXPOSE 80

# Start Nginx automatically
CMD ["nginx", "-g", "daemon off;"]
EOF

# 4. Build Docker image
echo "Building Docker image..."
sudo docker build -t nginx .

# 5. Run Docker container
echo "Running Docker container..."
sudo docker run -d -p 8080:80 --name my-nginx nginx

# 6. Display access information
echo "--------------------------------------------------"
echo "Static site is running at: http://instanceip:8080"
echo "Replace 'instanceip' with your AWS instance's public IP."
echo "--------------------------------------------------"
